{% extends "base.html" %}
{% load static %}

{% block title %}Shop - Furniture Store{% endblock %}
{% block meta_description %}Browse our complete collection of furniture and home decor items.{% endblock %}

{% block content %}
<!-- Start Hero Section -->
<div class="hero">
  <div class="container">
    <div class="row justify-content-between">
      <div class="col-lg-5">
        <div class="intro-excerpt">
          <h1>Shop</h1>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Hero Section -->

<div class="untree_co-section product-section before-footer-section">
  <div class="container">
    <div class="row">
      <!-- Filters Sidebar -->
      <div class="col-md-3 mb-4">
        <div class="card filter-card">
          <div class="card-header text-white" style="background-color: #3b5d50;">
            <h5 class="mb-0">Filters</h5>
          </div>
          <div class="card-body">
            <form method="get" id="filterForm">
              <!-- Search -->
              <div class="mb-3">
                <label class="form-label fw-bold">Search</label>
                <input type="text" name="q" class="form-control" placeholder="Search products..." value="{{ search_query }}">
              </div>

              <!-- Category Filter -->
              <div class="mb-3">
                <label class="form-label fw-bold filter-category-label">Category</label>
                <select name="category" class="form-control">
                  <option value="">All Categories</option>
                  {% for category in categories %}
                    <option value="{{ category.slug }}" {% if category_slug == category.slug %}selected{% endif %}>{{ category.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <!-- Price Range -->
              <div class="mb-3">
                <label class="form-label fw-bold">Price Range</label>
                <div class="row g-2">
                  <div class="col-6">
                    <input type="number" name="min_price" class="form-control" placeholder="Min" value="{{ min_price }}">
                  </div>
                  <div class="col-6">
                    <input type="number" name="max_price" class="form-control" placeholder="Max" value="{{ max_price }}">
                  </div>
                </div>
              </div>

              <!-- Stock Status -->
              <div class="mb-3">
                <label class="form-label fw-bold">Stock Status</label>
                <select name="in_stock" class="form-control">
                  <option value="">All</option>
                  <option value="true" {% if in_stock == "true" %}selected{% endif %}>In Stock</option>
                  <option value="false" {% if in_stock == "false" %}selected{% endif %}>Out of Stock</option>
                </select>
              </div>

              <!-- Sort -->
              <div class="mb-3">
                <label class="form-label fw-bold">Sort By</label>
                <select name="sort" class="form-control">
                  <option value="newest" {% if sort_by == "newest" %}selected{% endif %}>Newest</option>
                  <option value="price_low" {% if sort_by == "price_low" %}selected{% endif %}>Price: Low to High</option>
                  <option value="price_high" {% if sort_by == "price_high" %}selected{% endif %}>Price: High to Low</option>
                  <option value="name" {% if sort_by == "name" %}selected{% endif %}>Name</option>
                  <option value="rating" {% if sort_by == "rating" %}selected{% endif %}>Rating</option>
                </select>
              </div>

              <!-- Filter Buttons -->
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary">Apply Filters</button>
                <a href="{% url 'store:shop' %}" class="btn btn-outline-secondary">Clear All</a>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Products Column -->
      <div class="col-md-9">

        <!-- Products Grid -->
        <div class="row">
          {% for product in products %}
          <div class="col-12 col-md-6 col-lg-4 mb-5">
            <a class="product-item" href="{% url 'store:product_detail' slug=product.slug %}">
              {% if product.get_primary_image %}
                <img src="{{ product.get_primary_image.image.url }}" class="img-fluid product-thumbnail" alt="{{ product.name }}">
              {% else %}
                <img src="{% static 'images/product-1.png' %}" class="img-fluid product-thumbnail" alt="{{ product.name }}">
              {% endif %}
              <h3 class="product-title">{{ product.name }}</h3>
              <strong class="product-price">${{ product.price }}</strong>
              {% if not product.is_in_stock %}
                <span class="badge bg-danger">Out of Stock</span>
              {% endif %}
              <span class="icon-cross">
                <img src="{% static 'images/cross.svg' %}" class="img-fluid">
              </span>
            </a>
          </div>
          {% empty %}
          <div class="col-12">
            <p class="text-center">No products found.</p>
          </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.has_other_pages %}
        <div class="row">
          <div class="col-md-12">
            <nav aria-label="Page navigation">
              <ul class="pagination justify-content-center">
                {% if products.has_previous %}
                  <li class="page-item">
                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ products.previous_page_number }}">Previous</a>
                  </li>
                {% endif %}
                {% for num in products.paginator.page_range %}
                  {% if products.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                  {% else %}
                    <li class="page-item">
                      <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ num }}">{{ num }}</a>
                    </li>
                  {% endif %}
                {% endfor %}
                {% if products.has_next %}
                  <li class="page-item">
                    <a class="page-link" href="?{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}page={{ products.next_page_number }}">Next</a>
                  </li>
                {% endif %}
              </ul>
            </nav>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

